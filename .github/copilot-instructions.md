# Copilot Instructions
以下は全てのコードに適用されます。

---

## 1. 核心原理
あなたの任務は、単にコードを書くことではなく、「シンプル（短く単純）で、かつ機能的な、洗練されたシステム」を構築することです。
* 複雑なロジックは避け、可能な限り簡潔に書いてください。
* コードは他の人が最短時間で理解できるようにします。
* 仕様が不明確な場合、コードを書く前に必ず質問してください。

## 2. 命名規則
* 抽象的な名前よりも、具体的な名前を使う
* 名前と処理が一致していることを確認する
* ループイテレータが２文字以上になる場合、`i`, `j`, `k` ではなく `idx`, `row`, `col` 等の意味のある名前を使用する
* 単位を含める: 例 `length_m`, `time_ms`
* スコープが広い場合、より具体的な名前を使用するが、スコープが狭い場合は簡潔にする
* 不要な単語を切り捨てる：`convert_velocity` → `to_velocity`
* 一貫性を保つ
* 誤解されない名前を選ぶ

### 2.1 基本ルール
Google C++ Style Guide 準拠

| 対象 | 規則 | 例 |
| :--- | :--- | :--- |
| クラス / 構造体 | PascalCase | `SpeedMsg`, `BatteryStatus` |
| 関数 / 変数 | snake_case | `get_id()`, `target_velocity` |
| 定数 / 列挙値 | ALL_CAPS | `BATTERY_LOW` |
| プライベート変数 | 末尾にアンダースコア `_` | `speed_`, `voltage_` |

### 2.2 省略の許可と禁止
* **独自の短縮形は厳禁:** (`pos`, `cnt`, `mgr` 等は禁止)
* **標準略語は許可:** 誤解を生まず、広く知られる略語は許可します。
    * 許可例: `PWM`, `ID`, `CAN`, `IMU`, `PID`, `LED`, `USB`, `IP`, `GPIO`, `UART`, `SPI`, `I2C`, `RGB`
    * クラス名の場合は `Can` や `Pid` とはせず、`CAN` や `PID` のようにすべて大文字とし、省略されていることがわかるようにしてください。
* **単位の略語は許可:** `ms` (ミリ秒), `m` (メートル), `rad` (ラジアン) 等

## 3. 制約
* 三項演算子は使用禁止
* do-while文は禁止
* goto文は禁止

### 3.1 組み込みシステム (STM32/ESP32 等)
* **動的メモリの禁止:** `new`, `malloc`, `std::vector`, `std::string` 等の使用を禁止します。`std::array` や固定長配列を使用してください。
* **割り込み処理の制限:** コールバック内はフラグ操作のみに留め、重い計算処理を禁止してください。
* **例外の禁止:** オーバーヘッド回避のため、`try-catch` は使用しないでください。
* **定数の配置:** 定数は原則 `constexpr` を使用し、実行時にしか確定しない値のみ `const` を使用してください。

### 3.2 ROS 2 / PC側 (Linux)
* **モダンC++の活用:** `std::unique_ptr` 等のスマートポインタを積極的に使用し、生ポインタは禁止します。
* **名前空間の徹底:** 全てのシンボルは名前空間に入れ、グローバル汚染を防いでください。
* **RAIIの徹底:** リソース管理はデストラクタに任せ、例外安全性を確保してください。
* **ログ出力:** `std::cout` ではなく、`RCLCPP_INFO` 等のROSロガーを使用してください。

## 4. ドキュメント
* **関数コメント:** 全ての関数にDoxygen形式のコメントを追加してください。
* **クラスコメント:** クラス定義の前に、その目的を示すコメントを追加してください。
* **処理に関するコメント:** 意図を明確にするため、簡潔にコメントを追加してください。コードから明らかな場合は不要です。
* **要約コメント:** 全体像を把握しやすくするため、5行近く処理が続く場合にブロック分けを行い、要約コメントを１行追加してください。
* **README更新:** 主要な機能追加や変更時に、READMEを最新の状態に保ってください。
* **UML図:** 依存関係が3クラス以上にまたがるクラスやモジュールには、UML図を追加して理解を助けてください。

## 5. AIへの行動規範
* **ゲートキーパー機能:** 仕様に欠陥がある場合、コードを書く前に「このケースではどう動くべきか定義されていません」と指摘し、開発者に再考を促してください。
* **アーキテクチャ優先:** 実装前にクラス図やデータフロー図での合意形成を必須とします。
* **C++の不出来への対処:** 構文エラーや古い書き方に対しては、単に直すのではなく「なぜこの書き方がモダンで洗練されているのか」を1行で説明してください。